<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org/">
<head th:replace="~{fragments :: head}"></head>
<nav th:replace="~{fragments :: header}"></nav>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Merchandise Purchase</title>
</head>
<body>
<!-- display product drop down and user fields-->
<form id="purchaseForm" th:action="@{/purchase}" method="post" onsubmit="return validateForm()">
  <label for="itemName">Select Item:</label>
  <select id="itemName" name="itemName">
    <option value="hat">$15 "Wanderer" Hat</option>
    <option value="shirt">$20 "Guru" Shirt</option>
    <option value="hoodie">$30 "Zen"Hooded Sweatshirt</option>
  </select>

  <label for="name">Name:</label>
  <input type="text" id="name" name="name" required>

  <label for="address">Address:</label>
  <input type="text" id="address" name="address" required>

  <label for="creditCard">Credit Card Number:</label>
  <input type="text" id="creditCard" name="creditCard" pattern="\d{16}" title="Credit card must be 16 digits long" required>
  <!-- set name and expectations for user fields-->
  <label for="expiration">Expiration Date:</label>
  <input type="text" id="expiration" name="expiration" pattern="\d{4}" title="Expiration must be 4 digits long" placeholder="MMYY" required>

  <label for="zipCode">Zip Code:</label>
  <input type="text" id="zipCode" name="zipCode" pattern="\d{5}" title="Zip code must be 5 digits long" required>

  <button type="submit">Purchase</button>
</form>

<div id="confirmation" th:if="${confirmation}" style="display: block;">
  <p>Thank you for your purchase!</p>
</div>

<div th:if="${error}" style="color: red;">
  <p th:text="${error}"></p>
</div>
<!-- client side validation of user fields -->
<script th:inline="javascript">
  function validateForm() {
      let name = document.getElementById('name').value;
      let address = document.getElementById('address').value;
      let creditCard = document.getElementById('creditCard').value;
      let expiration = document.getElementById('expiration').value;
      let zipCode = document.getElementById('zipCode').value;

              if (!isString(name) || !isString(address)) {
            alert('Name and address must be strings.');
            return false;
        }

        if (!isNumber(creditCard) || !isNumber(expiration) || !isNumber(zipCode)) {
            alert('Credit card, expiration, and zip code must be numbers.');
            return false;
        }

        if (creditCard.length !== 16) {
            alert('Credit card must be 16 digits long.');
            return false;
        }

        if (expiration.length !== 4) {
            alert('Expiration must be 4 digits long.');
            return false;
        }

        if (zipCode.length !== 5) {
            alert('Zip code must be 5 digits long.');
            return false;
        }

        return true;
    }

    function isString(value) {
        return typeof value === 'string' || value instanceof String;
    }

    function isNumber(value) {
        return !isNaN(parseFloat(value)) && isFinite(value);
    }
</script>

</body>
</html>
