<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org/">

<head th:replace="~{fragments :: head}">
    <li th:each="item : ${packingList}" th:text="${item}"></li>
</head>

<nav th:replace="~{fragments :: header}"></nav>

<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<!--<body>-->
<!--&lt;!&ndash;the "?" in user?.email&ndash;&gt;-->
<!--<p th:text="${user?.email}"></p>-->

<!--</body>-->
<!--</html>-->
<style>
    .list-group{
    width:50%;
    text-align: center;
    float: right;
    }
    .textInput{
    width:25%;
    }
</style>



<body>


<div>
    <form id="packingListForm" method="post" class="textInput">
        <input type="text" id="itemInput" class="form-text text-muted form-control" placeholder="Enter a new item" />
        <input type="number" id="itemQuantity" class="form-text text-muted form-control" placeholder="Enter item Amount" />

        <input type="hidden" name="jsonData" id="jsonData"/>

        <button type="button" class="btn btn-primary" onclick="addItem()">Add Item</button>

        <table class="table">
            <thead>
            <tr>
                <th scope="col">Item</th>
                <th scope="col">Quantity</th>
            </tr>
            </thead>
            <tbody id="newItemsTableBody">
            </tbody>
        </table>
        <button type="button" class="btn btn-primary" onclick="submitForm()">Save Changes</button>
    </form>

</div>



<!--<textarea id="itemQuantityTextArea" rows="4" cols="30" class="form-control" readonly></textarea>-->
<!--<textarea id="packingItemsTextArea" rows="4" cols="30" class="form-control" readonly></textarea>-->





<script th:inline="javascript">
    let arrayOfItems = [];
    let quantityArray = [];

    function addItem() {
        let itemInput = document.getElementById('itemInput');
        let newItem = itemInput.value.trim();
        let itemQuantity = document.getElementById('itemQuantity');
        let newNumber = itemQuantity.value.trim();

        if (newItem !== '' && newNumber !== '') {
            arrayOfItems.push(newItem);
            quantityArray.push(newNumber);
            updateItemTable();
            itemInput.value = '';
            itemQuantity.value = '';
        }
    }

    function updateItemTable() {
        let newItemsTableBody = document.getElementById('newItemsTableBody');
        newItemsTableBody.innerHTML = '';

        for (let i = 0; i < arrayOfItems.length; i++) { //loops through the items and inputs a table for each string and number
            let tableRow = document.createElement('tr');
            let itemNameCell = document.createElement('td');
            let quantityCell = document.createElement('td');

            itemNameCell.textContent = arrayOfItems[i];
            quantityCell.textContent = quantityArray[i];

            tableRow.appendChild(itemNameCell);
            tableRow.appendChild(quantityCell);

            newItemsTableBody.appendChild(tableRow);
        }
    }

    function submitForm() {
        let data = {
            arrayOfItems: arrayOfItems,
            quantityArray: quantityArray
        };


        let jsonData = JSON.stringify(data);

        let hiddenInput = document.createElement('input');
        hiddenInput.type = 'hidden';
        hiddenInput.name = 'jsonData';
        hiddenInput.value = jsonData;

        let form = document.getElementById('packingListForm');
        form.appendChild(hiddenInput);

        if (form.firstChild) {
            form.insertBefore(hiddenInput, form.firstChild);
        } else {
            form.appendChild(hiddenInput);
        }

        form.submit();
    }

</script>

</body>

</html>
